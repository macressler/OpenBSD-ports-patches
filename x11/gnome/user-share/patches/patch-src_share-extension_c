$OpenBSD: patch-src_share-extension_c,v 1.2 2013/04/08 09:05:42 ajacoutot Exp $

https://bugzilla.gnome.org/show_bug.cgi?id=697537

--- src/share-extension.c.orig	Tue Jan 15 17:43:03 2013
+++ src/share-extension.c	Mon Apr  8 10:21:30 2013
@@ -28,7 +28,9 @@
 #include <glib/gi18n-lib.h>
 #include <gio/gdesktopappinfo.h>
 #include <gtk/gtk.h>
+#ifdef HAVE_BLUETOOTH
 #include <bluetooth-client.h>
+#endif
 #include <libnautilus-extension/nautilus-menu-provider.h>
 #include <libnautilus-extension/nautilus-location-widget-provider.h>
 
@@ -92,6 +94,7 @@ bar_response_cb (NautilusShareBar *bar,
 static void
 downloads_bar_set_from_bluetooth_status (GtkWidget *bar)
 {
+#ifdef HAVE_BLUETOOTH
 	BluetoothClient *client;
 	gboolean bt_powered;
 
@@ -100,6 +103,7 @@ downloads_bar_set_from_bluetooth_status (GtkWidget *ba
 		      "default-adapter-powered", &bt_powered,
 		      NULL);
 	gtk_widget_set_visible (bar, bt_powered);
+#endif
 }
 
 static void
@@ -152,6 +156,7 @@ nautilus_user_share_get_location_widget (NautilusLocat
 		bar = nautilus_share_bar_new (_("May be used to share or receive files"));
 	} else if (is_dir[0] != FALSE) {
 		bar = nautilus_share_bar_new (_("May be shared over the network or Bluetooth"));
+#ifdef HAVE_BLUETOOTH
 	} else {
 		BluetoothClient *client;
 
@@ -162,6 +167,7 @@ nautilus_user_share_get_location_widget (NautilusLocat
 		g_signal_connect (G_OBJECT (client), "notify::default-adapter-powered",
 				  G_CALLBACK (default_adapter_powered_cb), bar);
 		downloads_bar_set_from_bluetooth_status (bar);
+#endif
 	}
 
 	g_signal_connect (bar, "response",
