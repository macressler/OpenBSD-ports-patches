$OpenBSD: patch-configure_ac,v 1.2 2013/04/10 09:40:02 ajacoutot Exp $

https://bugzilla.gnome.org/show_bug.cgi?id=697537

--- configure.ac.orig	Mon Mar 25 12:33:35 2013
+++ configure.ac	Wed Apr 10 10:20:02 2013
@@ -54,7 +54,7 @@ fi
 
 AC_SUBST(HTTPD)
 
-PKG_CHECK_MODULES(USER_SHARE, glib-2.0 >= 2.28 gio-2.0 >= 2.26 gtk+-3.0 dbus-1 >= 1.1.1 dbus-glib-1 libnotify libcanberra-gtk3 gnome-bluetooth-1.0 >= 2.91.5)
+PKG_CHECK_MODULES(USER_SHARE, glib-2.0 >= 2.28 gio-2.0 >= 2.26 gtk+-3.0 dbus-1 >= 1.1.1 dbus-glib-1 libnotify libcanberra-gtk3)
 AC_SUBST(USER_SHARE_CFLAGS)
 AC_SUBST(USER_SHARE_LIBS)
 
@@ -116,6 +116,24 @@ MODULES_PATH=$with_modules_path
 AC_SUBST(MODULES_PATH)
 
 dnl===========================================================================
+dnl disable bluetooth on non Linux platforms (needs bluez and udev)
+
+case $host_os in
+  linux*)
+    PKG_CHECK_MODULES(BLUETOOTH, gnome-bluetooth-1.0 >= 2.91.5)
+    have_bluetooth=yes
+    ;;
+  *)
+    have_bluetooth=no
+    ;;
+esac
+
+if test "x$have_bluetooth" = xyes ; then
+        AC_DEFINE(HAVE_BLUETOOTH, 1, [Define to 1 if bluetooth support is available])
+fi
+AM_CONDITIONAL(HAVE_BLUETOOTH, [test x"$have_bluetooth" = x"yes"])
+
+dnl===========================================================================
 dnl Check for nautilus for the share bar
 
 AC_ARG_WITH(nautilusdir,
@@ -124,7 +142,7 @@ AC_ARG_WITH(nautilusdir,
 	    [ac_with_nautilusdir=""])
 
 PKG_CHECK_MODULES(EXTENSION,
-		   libnautilus-extension >= 2.91.7 gnome-bluetooth-1.0)
+		   libnautilus-extension >= 2.91.7)
 if test "${ac_with_nautilusdir}" = ""; then
 	ac_with_nautilusdir=`pkg-config --variable=extensiondir libnautilus-extension`
 fi
@@ -186,6 +204,7 @@ data/icons/32x32/Makefile
 data/icons/48x48/Makefile
 data/gnome-user-share.desktop.in
 data/org.gnome.desktop.file-sharing.gschema.xml.in
+data/org.gnome.desktop.file-sharing-bluetooth.gschema.xml.in
 po/Makefile.in
 src/Makefile
 help/Makefile
