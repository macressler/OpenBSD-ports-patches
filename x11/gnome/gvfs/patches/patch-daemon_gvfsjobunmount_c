$OpenBSD: patch-daemon_gvfsjobunmount_c,v 1.3 2012/02/16 22:17:38 ajacoutot Exp $

From e523572e14a9042696e1c5ccd4f30cb3240fa0df Mon Sep 17 00:00:00 2001
From: Giovanni Campagna <gcampagna@src.gnome.org>
Date: Tue, 07 Feb 2012 14:25:05 +0000
Subject: GVfsJobUnmount: check that vfunc is implemented before calling it

--- daemon/gvfsjobunmount.c.orig	Mon Oct 17 14:40:15 2011
+++ daemon/gvfsjobunmount.c	Tue Feb  7 16:03:41 2012
@@ -130,6 +130,9 @@ run (GVfsJob *job)
   GVfsJobUnmount *op_job = G_VFS_JOB_UNMOUNT (job);
   GVfsBackendClass *class = G_VFS_BACKEND_GET_CLASS (op_job->backend);
 
+  if (class->unmount == NULL)
+    return;
+
   class->unmount (op_job->backend,
 		  op_job,
                   op_job->flags,
@@ -218,11 +221,13 @@ try (GVfsJob *job)
 
   if (job_finish_immediately_if_possible (op_job))
     return TRUE;
-  else
+  else if (class->try_unmount != NULL)
     return class->try_unmount (op_job->backend,
 			       op_job,
 			       op_job->flags,
 			       op_job->mount_source);
+  else
+    return FALSE;
 }
 
 static void
