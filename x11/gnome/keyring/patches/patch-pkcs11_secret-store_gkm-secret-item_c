$OpenBSD: patch-pkcs11_secret-store_gkm-secret-item_c,v 1.1 2012/08/13 09:26:32 ajacoutot Exp $

From 979bf3c2a3a264630eace3ba2da0db14c59a67de Mon Sep 17 00:00:00 2001
From: Stef Walter <stefw@gnome.org>
Date: Wed, 08 Aug 2012 13:08:22 +0000
Subject: secret-store: Mark a secret item as 'used' when accessed

--- pkcs11/secret-store/gkm-secret-item.c.orig	Mon Apr  9 10:27:37 2012
+++ pkcs11/secret-store/gkm-secret-item.c	Mon Aug 13 11:19:10 2012
@@ -224,6 +224,7 @@ gkm_secret_item_real_get_attribute (GkmObject *base, G
 		identifier = gkm_secret_object_get_identifier (GKM_SECRET_OBJECT (self));
 		secret = gkm_secret_data_get_raw (sdata, identifier, &n_secret);
 		rv = gkm_attribute_set_data (attr, secret, n_secret);
+		gkm_object_mark_used (base);
 		g_object_unref (sdata);
 		return rv;
 
