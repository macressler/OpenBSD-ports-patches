$OpenBSD: patch-daemon_gdm-manager_c,v 1.1 2013/05/17 14:55:58 ajacoutot Exp $

From c08e9a6a16b2fa953c6ee90b2a6adb618cba5942 Mon Sep 17 00:00:00 2001
From: Colin Walters <walters@verbum.org>
Date: Fri, 17 May 2013 13:37:39 +0000
Subject: manager: Don't attempt to unexport DBus object if connection is closed

--- daemon/gdm-manager.c.orig	Mon Apr 15 23:02:31 2013
+++ daemon/gdm-manager.c	Fri May 17 16:40:22 2013
@@ -1135,7 +1135,8 @@ unexport_display (const char *id,
                   GdmDisplay *display,
                   GdmManager *manager)
 {
-    g_dbus_object_manager_server_unexport (manager->priv->object_manager, id);
+        if (!g_dbus_connection_is_closed (manager->priv->connection))
+                g_dbus_object_manager_server_unexport (manager->priv->object_manager, id);
 }
 
 static void
