$OpenBSD: patch-src_util_c,v 1.6 2011/11/06 20:23:25 dcoppa Exp $

bugfix: properly free memory/close fd upon errors
(upstream git commit e1631d6320cf6b47c3b46f0b56ae970986c9c20c)

--- src/util.c.orig	Sun Aug 28 19:48:13 2011
+++ src/util.c	Mon Oct 31 12:44:02 2011
@@ -374,11 +374,13 @@ char *store_restart_layout() {
         if (n == -1) {
             perror("write()");
             free(filename);
+            close(fd);
             return NULL;
         }
         if (n == 0) {
             printf("write == 0?\n");
             free(filename);
+            close(fd);
             return NULL;
         }
         written += n;
