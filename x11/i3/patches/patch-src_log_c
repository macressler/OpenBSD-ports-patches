$OpenBSD: patch-src_log_c,v 1.1 2011/11/06 20:23:25 dcoppa Exp $

bugfix: make sure the file descriptor is closed within the child
after forking (git commit 8adcf3e5d102647e9cc6c4cce7e6d0c7a9f3a9bb)

--- src/log.c.orig	Sun Aug 28 19:48:13 2011
+++ src/log.c	Mon Oct 31 12:44:02 2011
@@ -16,6 +16,8 @@
 #include <stdbool.h>
 #include <stdlib.h>
 #include <sys/time.h>
+#include <unistd.h>
+#include <fcntl.h>
 
 #include "util.h"
 #include "log.h"
@@ -41,6 +43,9 @@ void init_logging() {
     }
 
     errorfile = fopen(errorfilename, "w");
+    if (fcntl(fileno(errorfile), F_SETFD, FD_CLOEXEC)) {
+        ELOG("Could not set close-on-exec flag\n");
+    }
 }
 
 /*
