$OpenBSD: patch-libi3_font_c,v 1.1 2014/01/11 16:04:43 dcoppa Exp $

commit 0883dfbe14628430caaeefdb00e282a008d30d76
Author: Michael Stapelberg <michael@stapelberg.de>
Date:   Tue Dec 24 10:35:56 2013 +0100

only LOG() the DPI when it changes, DLOG() it otherwise

This avoids flooding stdout every time some text (e.g. a window
decoration) is drawn, yet leaves the message in place when it's actually
relevant (upon DPI changes).

--- libi3/font.c.orig	Sun Dec 22 21:12:41 2013
+++ libi3/font.c	Fri Jan 10 21:41:56 2014
@@ -30,6 +30,10 @@ static double pango_font_red;
 static double pango_font_green;
 static double pango_font_blue;
 
+/* Necessary to track whether the dpi changes and trigger a LOG() message,
+ * which is more easily visible to users. */
+static double logged_dpi = 0.0;
+
 static PangoLayout *create_layout_with_dpi(cairo_t *cr) {
     PangoLayout *layout;
     PangoContext *context;
@@ -37,7 +41,12 @@ static PangoLayout *create_layout_with_dpi(cairo_t *cr
     context = pango_cairo_create_context(cr);
     const double dpi = (double)root_screen->height_in_pixels * 25.4 /
                        (double)root_screen->height_in_millimeters;
-    LOG("X11 root window dictates %f DPI\n", dpi);
+    if (logged_dpi != dpi) {
+        logged_dpi = dpi;
+        LOG("X11 root window dictates %f DPI\n", dpi);
+    } else {
+        DLOG("X11 root window dictates %f DPI\n", dpi);
+    }
     pango_cairo_context_set_resolution(context, dpi);
     layout = pango_layout_new(context);
     g_object_unref(context);
