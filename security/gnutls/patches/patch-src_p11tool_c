$OpenBSD: patch-src_p11tool_c,v 1.1 2013/09/06 16:27:51 ajacoutot Exp $

From 1df1b0f7b28c733bf01e5d1faa2f8ccdb3db1665 Mon Sep 17 00:00:00 2001
From: Nikos Mavrogiannopoulos <nmav@gnutls.org>
Date: Mon, 2 Sep 2013 13:47:18 +0300
Subject: [PATCH] Avoid using gnulib's error()

--- src/p11tool.c.orig	Sat Aug 10 11:30:18 2013
+++ src/p11tool.c	Fri Sep  6 17:25:49 2013
@@ -39,7 +39,6 @@
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <fcntl.h>
-#include <error.h>
 
 /* Gnulib portability files. */
 #include <read-file.h>
@@ -97,7 +96,10 @@ cmd_parser (int argc, char **argv)
     printf ("Setting log level to %d\n", debug);
 
   if ((ret = gnutls_global_init ()) < 0)
-    error (EXIT_FAILURE, 0, "global_init: %s", gnutls_strerror (ret));
+    {
+      fprintf (stderr, "global_init: %s", gnutls_strerror (ret));
+      exit(1);
+    }
 
   if (HAVE_OPT(PROVIDER))
     {
@@ -108,8 +110,11 @@ cmd_parser (int argc, char **argv)
         {
           ret = gnutls_pkcs11_add_provider (OPT_ARG(PROVIDER), NULL);
           if (ret < 0)
-            error (EXIT_FAILURE, 0, "pkcs11_add_provider: %s",
+            {
+              fprintf (stderr, "pkcs11_add_provider: %s",
                    gnutls_strerror (ret));
+              exit(1);
+            }
         }
     }
   else
@@ -123,7 +128,10 @@ cmd_parser (int argc, char **argv)
     {
       outfile = safe_open_rw (OPT_ARG(OUTFILE), 0);
       if (outfile == NULL)
-        error (EXIT_FAILURE, errno, "%s", OPT_ARG(OUTFILE));
+        {
+          fprintf (stderr, "%s", OPT_ARG(OUTFILE));
+          exit(1);
+        }
     }
   else
     outfile = stdout;
