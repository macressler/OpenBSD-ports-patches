$OpenBSD: patch-common_compat_h,v 1.1 2013/03/19 16:07:49 ajacoutot Exp $

From 7c27e9fbbe86b3268065f248eab2d6964983a715 Mon Sep 17 00:00:00 2001
From: Stef Walter <stefw@gnome.org>
Date: Tue, 19 Mar 2013 13:50:32 +0000
Subject: trust: Don't use POSIX or GNU basename()

--- common/compat.h.orig	Mon Mar 11 18:06:27 2013
+++ common/compat.h	Tue Mar 19 14:55:13 2013
@@ -72,12 +72,6 @@
 const char * getprogname (void);
 #endif
 
-#ifndef HAVE_BASENAME
-
-char *       basename    (const char *name);
-
-#endif /* HAVE_BASENAME */
-
 #ifndef HAVE_MKSTEMP
 
 int          mkstemp     (char *template);
@@ -219,6 +213,17 @@ p11_mmap *  p11_mmap_open   (const char *path,
 void        p11_mmap_close  (p11_mmap *map);
 
 #endif /* OS_UNIX */
+
+/*
+ * The semantics of both POSIX basename() and GNU asename() are so crappy that
+ * we just don't even bother. And what's worse is how it completely changes
+ * behavior if _GNU_SOURCE is defined. Nasty stuff.
+ */
+char *       p11_basename   (const char *name);
+
+/* ----------------------------------------------------------------------------
+ * MORE COMPAT
+ */
 
 #ifdef	HAVE_ERRNO_H
 #include <errno.h>
