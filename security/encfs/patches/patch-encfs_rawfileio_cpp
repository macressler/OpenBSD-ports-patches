$OpenBSD: patch-encfs_rawfileio_cpp,v 1.1.1.1 2014/01/17 10:10:58 stsp Exp $
--- encfs/RawFileIO.cpp.orig	Sun Nov 29 23:04:12 2009
+++ encfs/RawFileIO.cpp	Thu Jan 16 16:56:14 2014
@@ -122,7 +122,7 @@ static int open_readonly_workaround(const char *path, 
     -  Also keep the O_LARGEFILE flag, in case the underlying filesystem needs
        it..
 */
-int RawFileIO::open(int flags)
+int RawFileIO::open(int flags, mode_t mode)
 {
     bool requestWrite = ((flags & O_RDWR) || (flags & O_WRONLY));
 
@@ -139,6 +139,9 @@ int RawFileIO::open(int flags)
     {
 	int finalFlags = requestWrite ? O_RDWR : O_RDONLY;
 
+	if (flags & O_CREAT)
+		finalFlags = flags;
+
 #if defined(O_LARGEFILE)
 	if( flags & O_LARGEFILE )
 	    finalFlags |= O_LARGEFILE;
@@ -146,8 +149,13 @@ int RawFileIO::open(int flags)
 #warning O_LARGEFILE not supported
 #endif
 
-	int newFd = ::open( name.c_str(), finalFlags );
-	
+
+	int newFd;
+	if (flags & O_CREAT)
+		newFd = ::open( name.c_str(), finalFlags, mode);
+	else
+		newFd = ::open( name.c_str(), finalFlags);
+
 	rDebug("open file with flags %i, result = %i", finalFlags, newFd);
 
 	if((newFd == -1) && (errno == EACCES))
