$OpenBSD: patch-Makerules,v 1.11 2014/04/17 20:30:57 sthen Exp $
--- Makerules.orig	Fri Apr 11 16:10:41 2014
+++ Makerules	Thu Apr 17 21:11:06 2014
@@ -7,6 +7,7 @@ OS := $(OS:Darwin=MACOS)
 
 CFLAGS += -Wall
 
+ifneq "$(OS)" "OpenBSD" # don't override C optimizer flags for ports builds
 ifeq "$(build)" "debug"
 CFLAGS += -pipe -g -DDEBUG
 else ifeq "$(build)" "profile"
@@ -24,6 +25,7 @@ CFLAGS += -pipe -g -DMEMENTO -DDEBUG
 else
 $(error unknown build setting: '$(build)')
 endif
+endif
 
 # Windows (MINGW) build doesn't use system libraries.
 ifeq "$(OS)" "MINGW"
@@ -54,7 +56,7 @@ LD = xcrun ld
 RANLIB_CMD = xcrun ranlib $@
 
 # Linux uses pkg-config for system libraries.
-else ifeq "$(OS)" "Linux"
+else
 
 HAVE_X11 ?= yes
 
@@ -64,15 +66,15 @@ SYS_OPENSSL_LIBS = $(shell pkg-config --libs libcrypto
 endif
 
 # TODO: use pkg-config for system CURL
-SYS_CURL_DEPS = -lpthread -lrt
+SYS_CURL_DEPS = -lpthread
 
 SYS_X11_CFLAGS = $(shell pkg-config --cflags x11 xext)
 SYS_X11_LIBS = $(shell pkg-config --libs x11 xext)
 
 SYS_FREETYPE_CFLAGS = $(shell pkg-config --cflags freetype2)
 SYS_FREETYPE_LIBS = $(shell pkg-config --libs freetype2)
-SYS_OPENJPEG_CFLAGS = $(shell pkg-config --cflags libopenjpeg1)
-SYS_OPENJPEG_LIBS = $(shell pkg-config --libs libopenjpeg1)
+SYS_OPENJPEG_CFLAGS = -I${LOCALBASE}/include/openjp2 -I${LOCALBASE}/include
+SYS_OPENJPEG_LIBS = -L${LOCALBASE}/lib -lopenjp2
 SYS_JBIG2DEC_LIBS = -ljbig2dec
 SYS_JPEG_LIBS = -ljpeg
 SYS_ZLIB_LIBS = -lz
