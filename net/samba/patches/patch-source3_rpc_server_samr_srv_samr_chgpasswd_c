$OpenBSD: patch-source3_rpc_server_samr_srv_samr_chgpasswd_c,v 1.1 2012/12/17 00:52:58 brad Exp $
--- source3/rpc_server/samr/srv_samr_chgpasswd.c.orig	Sat Dec  8 23:53:28 2012
+++ source3/rpc_server/samr/srv_samr_chgpasswd.c	Sat Dec  8 23:54:49 2012
@@ -73,8 +73,12 @@ static int findpty(char **slave)
 	*slave = NULL;
 
 #if defined(HAVE_GRANTPT)
+#if defined(HAVE_POSIX_OPENPT)
+	if ((master = posix_openpt(O_RDWR|O_NOCTTY)) >= 0) {
+#else
 	/* Try to open /dev/ptmx. If that fails, fall through to old method. */
 	if ((master = sys_open("/dev/ptmx", O_RDWR, 0)) >= 0) {
+#endif
 		grantpt(master);
 		unlockpt(master);
 		line = (char *)ptsname(master);
