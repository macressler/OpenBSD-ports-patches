$OpenBSD: patch-pwhois,v 1.1 2014/05/30 13:11:34 giovanni Exp $
--- pwhois.orig	Fri Jan 24 08:57:19 2014
+++ pwhois	Thu May 29 13:03:50 2014
@@ -158,8 +158,12 @@ sub detect_encodings {
         $output_cp = 'cp'.$data;
     } else {
         # Read encoding from environment
-        (my $cp = $ENV{LANG}) =~ s/^[a-z]{2}_[A-Z]{2}\.//;
-        $input_cp = $output_cp = lc $cp;
+	if (defined $ENV{LANG}) {
+            (my $cp = $ENV{LANG}) =~ s/^[a-z]{2}_[A-Z]{2}\.//;
+            $input_cp = $output_cp = lc $cp;
+	} else {
+            $input_cp = $output_cp = 'C';
+	}
     }
 
     return ($input_cp, $output_cp);
