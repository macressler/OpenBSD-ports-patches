$OpenBSD: patch-tools_virsh-domain_c,v 1.2 2012/09/05 06:29:02 jasper Exp $

From 15d2c9fad4817176caf14b0b72c99e6e051ca0cc Mon Sep 17 00:00:00 2001
From: Paul Eggert <eggert@cs.ucla.edu>
Date: Tue, 4 Sep 2012 10:03:41 -0700
Subject: [PATCH] Pass a correct pointer type to localtime_r(3).

--- tools/virsh-domain.c.orig	Fri Aug 31 13:59:31 2012
+++ tools/virsh-domain.c	Tue Sep  4 19:25:05 2012
@@ -3782,7 +3782,7 @@ static char *
 vshGenFileName(vshControl *ctl, virDomainPtr dom, const char *mime)
 {
     char timestr[100];
-    struct timeval cur_time;
+    time_t cur_time;
     struct tm time_info;
     const char *ext = NULL;
     char *ret = NULL;
@@ -3803,8 +3803,8 @@ vshGenFileName(vshControl *ctl, virDomainPtr dom, cons
         ext = ".png";
     /* add mime type here */
 
-    gettimeofday(&cur_time, NULL);
-    localtime_r(&cur_time.tv_sec, &time_info);
+    time (&cur_time);
+    localtime_r(&cur_time, &time_info);
     strftime(timestr, sizeof(timestr), "%Y-%m-%d-%H:%M:%S", &time_info);
 
     if (virAsprintf(&ret, "%s-%s%s", virDomainGetName(dom),
