$OpenBSD: patch-configure_ac,v 1.5 2014/04/13 21:41:00 sthen Exp $
--- configure.ac.orig	Fri Apr  4 21:31:38 2014
+++ configure.ac	Sun Apr 13 15:12:37 2014
@@ -416,7 +416,7 @@ dnl Check for atomic operations support in the compile
 dnl
 AC_MSG_CHECKING([for GNU atomic operations support])
 AC_RUN_IFELSE([AC_LANG_PROGRAM([[
-    int n = 0;
+    long long n = 0;
 ]],[[
     __sync_add_and_fetch(&n, 10); // n becomes 10
     __sync_fetch_and_add(&n, 20); // n becomes 30
@@ -2966,6 +2966,14 @@ if test "x$squid_host_os" = "xmingw" ; then
   ac_cv_func_statfs='yes'
 fi
 
+dnl Some systems (mostly BSDs) require -lexecinfo for backtrace_symbols_fd()
+AC_CHECK_LIB(execinfo,backtrace_symbols_fd,[BACKTRACE_LIB="-lexecinfo"])
+oLIBS=$LIBS
+LIBS="$BACKTRACE_LIB"
+AC_CHECK_FUNCS(backtrace_symbols_fd)
+LIBS=$oLIBS
+AC_SUBST(BACKTRACE_LIB)
+
 dnl Check for library functions
 AC_CHECK_FUNCS(\
 	backtrace_symbols_fd \
@@ -3116,6 +3124,9 @@ AC_CHECK_TYPE(struct cmsghdr,AC_DEFINE(HAVE_CMSGHDR,1,
 ])
 
 AC_CHECK_TYPE(struct iovec,AC_DEFINE(HAVE_IOVEC,1,[The system provides struct iovec]),,[
+  #if HAVE_SYS_UIO_H
+  #include <sys/uio.h>
+  #endif
   #if HAVE_SYS_SOCKET_H
   #include <sys/socket.h>
   #endif
