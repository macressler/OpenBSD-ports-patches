$OpenBSD: patch-skia_skia_gyp,v 1.7 2013/01/18 21:38:02 robert Exp $
--- skia/skia.gyp.orig	Tue Jan  8 03:40:40 2013
+++ skia/skia.gyp	Mon Jan 14 19:47:35 2013
@@ -353,7 +353,7 @@
             '__ARM_HAVE_NEON',
           ],
         }],
-        [ 'target_arch == "arm"', {
+        [ 'target_arch == "arm" or disable_sse2 == 1', {
           'sources!': [
             '../third_party/skia/src/opts/opts_check_SSE2.cpp'
           ],
@@ -675,7 +675,7 @@
             'SK_BUILD_FOR_ANDROID_NDK',
           ],
         }],
-        [ 'target_arch != "arm"', {
+        [ 'target_arch != "arm" and disable_sse2 != 1', {
           'sources': [
             '../third_party/skia/src/opts/SkBitmapProcState_opts_SSE2.cpp',
             '../third_party/skia/src/opts/SkBlitRect_opts_SSE2.cpp',
@@ -690,8 +690,14 @@
               ],
             }],
           ],
-        },
-        {  # arm
+        },{ #disable_sse2 == 1
+          'sources': [
+            '../third_party/skia/src/opts/SkBitmapProcState_opts_none.cpp',
+            '../third_party/skia/src/opts/SkBlitRow_opts_none.cpp',
+            '../third_party/skia/src/opts/SkUtils_opts_none.cpp',
+          ],
+        }],
+        [ 'target_arch == "arm"', {
           'conditions': [
             [ 'armv7 == 1', {
               'defines': [
@@ -772,7 +778,7 @@
         '../third_party/skia/src/core',
       ],
       'conditions': [
-        [ 'OS in ["linux", "freebsd", "openbsd", "solaris"]', {
+        [ 'OS in ["linux", "freebsd", "solaris"]', {
           'cflags': [
             '-mssse3',
           ],
@@ -792,7 +798,7 @@
             ],
           },
         }],
-        [ 'target_arch != "arm"', {
+        [ 'target_arch != "arm" and OS != "openbsd"', {
           'sources': [
             '../third_party/skia/src/opts/SkBitmapProcState_opts_SSSE3.cpp',
           ],
