$OpenBSD: patch-tools_clang_lib_Basic_Targets_cpp,v 1.4 2012/04/23 23:11:01 sthen Exp $

- let profiling work on OpenBSD
- fix the symbol prefix to be empty rather than an underscore

--- tools/clang/lib/Basic/Targets.cpp.orig	Tue Oct 18 13:22:17 2011
+++ tools/clang/lib/Basic/Targets.cpp	Mon Apr 23 10:37:10 2012
@@ -363,11 +363,30 @@ class OpenBSDTargetInfo : public OSTargetInfo<Target> 
     DefineStd(Builder, "unix", Opts);
     Builder.defineMacro("__ELF__");
     if (Opts.POSIXThreads)
-      Builder.defineMacro("_POSIX_THREADS");
+      Builder.defineMacro("_REENTRANT");
   }
 public:
   OpenBSDTargetInfo(const std::string &triple)
-    : OSTargetInfo<Target>(triple) {}
+    : OSTargetInfo<Target>(triple) {
+      this->UserLabelPrefix = "";
+
+      llvm::Triple Triple(triple);
+      switch (Triple.getArch()) {
+        default:
+        case llvm::Triple::x86:
+        case llvm::Triple::x86_64:
+        case llvm::Triple::arm:
+       case llvm::Triple::sparc:
+          this->MCountName = "__mcount";
+          break;
+        case llvm::Triple::mips64:
+        case llvm::Triple::mips64el:
+        case llvm::Triple::ppc:
+       case llvm::Triple::sparcv9:
+          this->MCountName = "_mcount";
+          break;
+      }
+  }
 };
 
 // PSP Target
