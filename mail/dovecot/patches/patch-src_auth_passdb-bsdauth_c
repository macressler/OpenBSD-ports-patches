$OpenBSD: patch-src_auth_passdb-bsdauth_c,v 1.3 2012/11/25 00:58:38 halex Exp $
--- src/auth/passdb-bsdauth.c.orig	Sun Feb 12 17:55:54 2012
+++ src/auth/passdb-bsdauth.c	Mon Oct 29 22:42:37 2012
@@ -18,6 +18,7 @@ bsdauth_verify_plain(struct auth_request *request, con
 		    verify_plain_callback_t *callback)
 {
 	struct passwd pw;
+	const char *type;
 	int result;
 
 	auth_request_log_debug(request, "bsdauth", "lookup");
@@ -35,7 +36,8 @@ bsdauth_verify_plain(struct auth_request *request, con
 	}
 
 	/* check if the password is valid */
-	result = auth_userokay(request->user, NULL, NULL,
+	type = t_strdup_printf("auth-%s", request->service);
+	result = auth_userokay(request->user, NULL, t_strdup_noconst(type),
 			       t_strdup_noconst(password));
 
 	/* clear the passwords from memory */
